# Otaku-mori Pre-Commit Quality Gates
echo "ğŸŒ¸ Running Otaku-mori quality checks..."

# 1. Prisma Format & Generate
echo "ğŸ”§ Formatting Prisma schema..."
pnpm prisma format || {
  echo "âš ï¸  Prisma format failed. Check schema syntax."
}

echo "ğŸ”§ Generating Prisma client..."
pnpm prisma generate || {
  echo "âŒ Prisma generation failed. Fix schema errors."
  exit 1
}

# 2. TypeScript Typecheck (BLOCKING)
echo "ğŸ“ TypeScript typecheck..."
npm run typecheck || {
  echo "âŒ TypeScript errors found. Fix them before committing."
  exit 1
}

# 3. Prisma Audit (BLOCKING)
echo "ğŸ” Running Prisma audit..."
npm run prisma:audit || {
  echo "âŒ Prisma audit failed. Check schema/code consistency."
  exit 1
}

# 4. ESLint (WARNING ONLY - pre-existing errors need cleanup)
echo "ğŸ” Linting..."
npm run lint --max-warnings=999 || {
  echo "âš ï¸  ESLint errors found. Please fix when possible."
  echo "Continuing with commit (TypeScript is clean)..."
}

# 5. Prettier format check
echo "âœ¨ Checking code formatting..."
npm run format:check || {
  echo "âš ï¸  Code formatting issues detected. Run 'npm run format' to fix."
  echo "Continuing with commit..."
}

echo "âœ… All quality checks passed!"

